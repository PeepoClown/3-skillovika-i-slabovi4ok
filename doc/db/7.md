## Нормализация отношений. Многозначные зависимости и четвертая нормальная форма. Зависимости соединения и пятая нормальная форма.

### Четвертая нормальная форма

Отношение находится в 4НФ, если оно находится в НФБК и все нетривиальные многозначные 
зависимости фактически являются функциональными зависимостями от ее потенциальных ключей.

В отношении R (A, B, C) существует многозначная зависимость R.A -> R.B в том и только в том случае,
если множество значений B, соответствующее паре значений A и C, 
зависит только от A и не зависит от С.

Предположим, что рестораны производят разные виды пиццы, 
а службы доставки ресторанов работают только в определенных районах города. 
Составной первичный ключ соответствующей переменной отношения включает три атрибута: 
{Ресторан, Вид пиццы, Район доставки}.

Такая переменная отношения не соответствует 4НФ, так как существует следующая 
многозначная зависимость:

{Ресторан} → {Вид пиццы}
{Ресторан} → {Район доставки}

То есть, например, при добавлении нового вида пиццы придется внести по одному новому кортежу 
для каждого района доставки. 
Возможна логическая аномалия, при которой определенному виду пиццы будут соответствовать 
лишь некоторые районы доставки из обслуживаемых рестораном районов.

Для предотвращения аномалии нужно декомпозировать отношение, 
разместив независимые факты в разных отношениях. 
В данном примере следует выполнить декомпозицию на {Ресторан, Вид пиццы} и 
{Ресторан, Район доставки}.

Однако, если к исходной переменной отношения добавить атрибут, 
функционально зависящий от потенциального ключа, например цену с учётом стоимости доставки 
({Ресторан, Вид пиццы, Район доставки} → Цена), 
то полученное отношение будет находиться в 4НФ и его уже нельзя подвергнуть декомпозиции 
без потерь.

### Пятая нормальная форма

Зависимость соединения является предельным обобщением понятий многозначной и функциональной зависимости, то есть это наиболее общая форма зависимости между атрибутами отношения

Отношения находятся в 5НФ, если оно находится в 4НФ и 
отсутствуют сложные зависимые соединения между атрибутами.

Если «Атрибут_1» зависит от «Атрибута_2», а «Атрибут_2» в свою очередь зависит от «Атрибута_3», 
а «Атрибут_3» зависит от «Атрибута_1», то все три атрибута обязательно входят в один кортеж.

Это очень жесткое требование, которое можно выполнить лишь при дополнительных условиях. 
На практике трудно найти пример реализации этого требования в чистом виде.

Например, некоторая таблица содержит три атрибута «Поставщик», «Товар» и «Покупатель». 
Покупатель_1 приобретает несколько Товаров у Поставщика_1. 
Покупатель_1 приобрел новый Товар у Поставщика_2. 
Тогда в силу изложенного выше требования Поставщик_1 обязан поставлять Покупателю_1 
тот же самый новый Товар, а Поставщик_2 должен поставлять Покупателю_1, 
кроме нового Товара, всю номенклатуру Товаров Поставщика_1. 
Этого на практике не бывает. 
Покупатель свободен в своем выборе товаров. 
Поэтому для устранения отмеченного затруднения все три атрибута разносят по разным отношениям (таблицам). 
После выделения трех новых отношений (Поставщик, Товар и Покупатель) необходимо помнить, 
что при извлечении информации (например, о покупателях и товарах) необходимо в запросе соединить все три отношения. 
Любая комбинация соединения двух отношений из трех неминуемо приведет к извлечению неверной 
(некорректной) информации. 
Некоторые СУБД снабжены специальными механизмами, 
устраняющими извлечение недостоверной информации. 
Тем не менее, следует придерживаться общей рекомендации: 
структуру базы данных строить таким образом, чтобы избежать применения 4НФ и 5НФ.

Пятая нормальная форма ориентирована на работу с зависимыми соединениями. 

Указанные зависимые соединения между тремя атрибутами встречаются очень редко. 
Зависимые соединения между четырьмя, пятью и более атрибутами указать практически невозможно.

### Доменно-ключевая нормальная форма

Переменная отношения находится в ДКНФ тогда и только тогда, когда каждое наложенное на неё ограничение является логическим следствием ограничений доменов и ограничений ключей, наложенных на данную переменную отношения.

Ограничение домена – ограничение, предписывающее использовать для определённого атрибута значения только из некоторого заданного домена. Ограничение по своей сути является заданием перечня (или логического эквивалента перечня) допустимых значений типа и объявлением о том, что указанный атрибут имеет данный тип.

Ограничение ключа – ограничение, утверждающее, что некоторый атрибут или комбинация атрибутов является потенциальным ключом.

Любая переменная отношения, находящаяся в ДКНФ, обязательно находится в 5НФ. Однако не любую переменную отношения можно привести к ДКНФ.
